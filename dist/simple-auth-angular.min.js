"use strict";angular.module("simpleAuth",["LocalStorageModule","base64"]).provider("simpleAuth",function(){angular.module("LocalStorageModule").value("prefix","auth-module");var a=this,b=60,c="/",d="SimpleAuth",e=function(a,b,c){angular.injector(["base64"]).invoke(function(d){c(d.encode(a+":"+b))})};this.sessionExpiration=function(c){return b=c,a},this.redirectAfterLogout=function(b){return c=b,a},this.authorizationName=function(b){return d=b,a},this.getToken=function(b){return e=b,a},this.$get=["localStorageService","Base64","$location",function(a,f,g){var h=null,i=function(){var c=a.get("last-login");return null!==c&&Date.now()-c<=1e3*b},j=function(b,c){var d=function(b,c){angular.isDefined(c)&&angular.forEach(c,function(b,c){a.set(c,b)}),a.set("auth-token",b),g.path(null!==h?h:"/"),h=null},f=function(){};e(b,c,d,f)},k=function(){a.clearAll(),g.path(c)},l=function(){null===a.get("last-login")&&a.set("last-login",Date.now())},m=function(){i()||a.clearAll()},n=function(){a.clearAll(),h=g.path(),g.path("/login")},o=function(){return a.get("auth-token")},p=function(){return d},q=function(b,c){a.set(b,c)},r=function(b,c){var d=a.get(b);return angular.isDefined(c)&&null===d?c:d};return i()||a.clearAll(),{login:j,logout:k,setLastLogin:l,checkSessionValidity:m,requestLogin:n,getStoredToken:o,getAuthorizationName:p,isLoggedIn:i,putParam:q,getParam:r}}]}).factory("simpleAuthHttpInterceptor",["simpleAuth",function(a){var b=!1;return{request:function(c){var d=a.getStoredToken();return b=null!==d,b&&(c.headers.Authorization=a.getAuthorizationName()+" "+d),c},response:function(c){return b&&a.setLastLogin(),a.checkSessionValidity(),c},responseError:function(b){return 401===b.status&&a.requestLogin(),b}}}]).controller("SimpleAuthLoginCtrl",["simpleAuth","$scope",function(a,b){b.login=function(){a.login(b.username,b.password)}}]).controller("SimpleAuthLogoutCtrl",["simpleAuth",function(a){a.logout()}]).directive("showIfAuth",["$animate","simpleAuth",function(a,b){return function(c,d){c.$watch(function(){return b.isLoggedIn()},function(){a[b.isLoggedIn()?"removeClass":"addClass"](d,"ng-hide")})}}]).config(["$httpProvider","$routeProvider",function(a,b){a.interceptors.push("simpleAuthHttpInterceptor"),b.when("/login",{templateUrl:"views/login.html",controller:"SimpleAuthLoginCtrl"}).when("/logout",{template:"Logging out...",controller:"SimpleAuthLogoutCtrl"})}]);