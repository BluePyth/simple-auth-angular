"use strict";angular.module("simpleAuth",["LocalStorageModule","base64"]).provider("simpleAuth",function(){angular.module("LocalStorageModule").value("prefix","auth-module");var a=this,b="/",c="SimpleAuth",d=function(a,b,c){angular.injector(["base64"]).invoke(function(d){c(d.encode(a+":"+b))})};this.redirectAfterLogout=function(c){return b=c,a},this.authorizationName=function(b){return c=b,a},this.getToken=function(b){return d=b,a},this.$get=["localStorageService","$location",function(a,e){var f,g=function(){var b=a.get("last-login");return null!==b},h=function(b,c){var g=function(b,c){angular.isDefined(c)&&angular.forEach(c,function(b,c){a.set(c,b)}),a.set("auth-token",b),e.path(angular.isDefined(f)?f:"/"),f=void 0},h=function(){};d(b,c,g,h)},i=function(c){a.clearAll(),(angular.isUndefined(c.redirect)||c.redirect===!0)&&e.path(b)},j=function(){null===a.get("last-login")&&a.set("last-login",Date.now())},k=function(){g()||a.clearAll()},l=function(){a.clearAll(),f=e.path(),e.path("/login")},m=function(){return a.get("auth-token")},n=function(){return c},o=function(b,c){a.set(b,c)},p=function(b,c){var d=a.get(b);return angular.isDefined(c)&&null===d?c:d};return g()||a.clearAll(),{login:h,logout:i,setLastLogin:j,checkSessionValidity:k,requestLogin:l,getStoredToken:m,getAuthorizationName:n,isLoggedIn:g,putParam:o,getParam:p}}]}).factory("simpleAuthHttpInterceptor",["$q","simpleAuth",function(a,b){var c=!1;return{request:function(d){var e=b.getStoredToken();return c=null!==e,c&&(d.headers.Authorization=b.getAuthorizationName()+" "+e),d||a.when(d)},response:function(d){return c&&b.setLastLogin(),b.checkSessionValidity(),d||a.when(d)},responseError:function(c){return 401===c.status&&b.requestLogin(),a.reject(c)}}}]).controller("SimpleAuthLoginCtrl",["simpleAuth","$scope",function(a,b){b.login=function(){a.login(b.username,b.password)}}]).controller("SimpleAuthLogoutCtrl",["simpleAuth",function(a){a.logout()}]).directive("showIfAuth",["$animate","simpleAuth",function(a,b){return function(c,d){c.$watch(function(){return b.isLoggedIn()},function(){a[b.isLoggedIn()?"removeClass":"addClass"](d,"ng-hide")})}}]).config(["$httpProvider","$routeProvider",function(a,b){a.interceptors.push("simpleAuthHttpInterceptor"),b.when("/login",{templateUrl:"views/login.html",controller:"SimpleAuthLoginCtrl"}).when("/logout",{template:"Logging out...",controller:"SimpleAuthLogoutCtrl"})}]);