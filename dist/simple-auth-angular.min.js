"use strict";angular.module("simpleAuth",["LocalStorageModule","base64"]).provider("simpleAuth",function(){angular.module("LocalStorageModule").value("prefix","auth-module");var a=60,b="/",c="SimpleAuth";this.sessionExpiration=function(b){return a=b,this},this.redirectAfterLogout=function(a){return b=a,this},this.authorizationName=function(a){return c=a,this},this.$get=["localStorageService","Base64","$location",function(d,e,f){var g=null,h=function(){var b=d.get("last-login");return null!==b&&Date.now()-b<=1e3*a},i=function(a,b){d.set("auth-token",e.encode(a+":"+b)),f.path(null!==g?g:"/"),g=null},j=function(){d.clearAll(),f.path(b)},k=function(){null===d.get("last-login")&&d.set("last-login",Date.now())},l=function(){h()||d.clearAll()},m=function(){d.clearAll(),g=f.path(),f.path("/login")},n=function(){return d.get("auth-token")},o=function(){return c};return h()||d.clearAll(),{login:i,logout:j,setLastLogin:k,checkSessionValidity:l,requestLogin:m,getToken:n,getAuthorizationName:o,isLoggedIn:h}}]}).factory("simpleAuthHttpInterceptor",["simpleAuth",function(a){var b=!1;return{request:function(c){var d=a.getToken();return b=null!==d,b&&(c.headers.Authorization=a.getAuthorizationName()+" "+d),c},response:function(c){return b&&a.setLastLogin(),a.checkSessionValidity(),c},responseError:function(b){return 401===b.status&&a.requestLogin(),b}}}]).controller("AuthLoginCtrl",["simpleAuth","$scope",function(a,b){b.login=function(){a.login(b.username,b.password)}}]).controller("AuthLogoutCtrl",["simpleAuth",function(a){a.logout()}]).directive("showIfAuth",["$animate","simpleAuth",function(a,b){return function(c,d){c.$watch(function(){return b.isLoggedIn()},function(){a[b.isLoggedIn()?"removeClass":"addClass"](d,"ng-hide")})}}]).config(["$httpProvider","$routeProvider",function(a,b){a.interceptors.push("simpleAuthHttpInterceptor"),b.when("/login",{templateUrl:"views/login.html",controller:"AuthLoginCtrl"}).when("/logout",{template:"Logging out...",controller:"AuthLogoutCtrl"})}]);